{{ $title := site.Title | plainify }}
{{ $parts := split $title " " }}
{{ $scratch := newScratch }}
{{ range $parts }}
  {{ $part := trim . " " }}
  {{ if gt (len $part) 0 }}
    {{ $scratch.Add "initials" (upper (substr $part 0 1)) }}
  {{ end }}
{{ end }}
{{ $initials := $scratch.Get "initials" | default "LL" }}
<header class="site-header">
  <div class="container nav-inner">
    <a class="brand" href="{{ "/" | relURL }}">
      <span class="brand-mark">{{ $initials }}</span>
      <span class="brand-text">{{ site.Title }}</span>
    </a>
    <button class="menu-toggle" type="button" aria-label="Toggle menu" aria-expanded="false" aria-controls="site-menu" data-menu-toggle>
      <span></span>
      <span></span>
      <span></span>
    </button>
    <nav class="main-nav">
      <div class="nav-links" id="site-menu">
        {{ $currentPage := . }}
        {{ range site.Menus.main }}
          <a class="nav-link {{ if or ($currentPage.IsMenuCurrent "main" .) ($currentPage.HasMenuCurrent "main" .) }}is-active{{ end }}" href="{{ .URL | relURL }}">{{ .Name }}</a>
        {{ end }}
      </div>
    </nav>
    <div class="nav-actions">
      <a
        class="icon-button"
        href="{{ "search/" | relURL }}"
        aria-label="Search"
        aria-haspopup="dialog"
        aria-controls="search-dialog"
        aria-expanded="false"
        data-search-open
      >
        {{ partial "icon.html" (dict "name" "search") }}
      </a>
      {{ with (where site.Params.socialIcons "name" "buymeacoffee") }}
        {{ $coffee := index . 0 }}
        {{ $coffeeTitle := $coffee.title | default "Buy me a coffee" }}
        <a
          class="icon-button icon-button--coffee"
          href="{{ $coffee.url }}"
          title="{{ $coffeeTitle }}"
          aria-label="{{ $coffeeTitle }}"
          target="_blank"
          rel="noopener noreferrer"
        >
          {{ partial "icon.html" (dict "name" "buymeacoffee") }}
        </a>
      {{ end }}
      <button class="icon-button" type="button" aria-label="Toggle theme" data-theme-toggle>
        {{ partial "icon.html" (dict "name" "sun") }}
      </button>
    </div>
  </div>
</header>

{{ partial "search-dialog.html" . }}

<script>
  (function () {
    var toggle = document.querySelector("[data-menu-toggle]");
    var header = document.querySelector(".site-header");
    var menu = document.getElementById("site-menu");
    if (!toggle || !header || !menu) return;
    toggle.addEventListener("click", function () {
      var isOpen = header.classList.toggle("is-open");
      toggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
    });
  })();
</script>
