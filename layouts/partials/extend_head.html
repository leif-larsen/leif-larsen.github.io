{{- /* Cookie consent banner styles and script */ -}}
<style>
.cookie-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--theme);
    color: var(--primary);
    padding: 15px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    z-index: 1000;
    font-size: 14px;
    line-height: 1.4;
    border-top: 1px solid var(--border);
    display: none;
}

.cookie-banner.show {
    display: block;
}

.cookie-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 15px;
}

.cookie-text {
    flex: 1;
    min-width: 300px;
}

.cookie-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.cookie-btn {
    padding: 8px 16px;
    border: 1px solid var(--border);
    background: var(--theme);
    color: var(--primary);
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s ease;
    text-decoration: none;
    white-space: nowrap;
}

.cookie-btn:hover {
    background: var(--hljs-bg);
}

.cookie-btn.accept {
    background: var(--primary);
    color: var(--theme);
}

.cookie-btn.accept:hover {
    opacity: 0.9;
}

@media (max-width: 768px) {
    .cookie-content {
        flex-direction: column;
        text-align: center;
    }
    
    .cookie-text {
        min-width: unset;
    }
}
</style>

{{- /* Cookie consent banner HTML */ -}}
<div id="cookie-banner" class="cookie-banner">
    <div class="cookie-content">
        <div class="cookie-text">
            üç™ This website uses Google Analytics to understand how visitors interact with the site. 
            By clicking "Accept", you consent to the use of analytics cookies.
            <a href="/privacy/" style="color: var(--secondary); text-decoration: underline;">Privacy Policy</a>
        </div>
        <div class="cookie-buttons">
            <button class="cookie-btn" onclick="declineCookies()">Decline</button>
            <button class="cookie-btn accept" onclick="acceptCookies()">Accept</button>
        </div>
    </div>
</div>

{{- /* Cookie consent and Google Analytics script */ -}}
<script>
// Cookie consent functions
function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = name + '=' + value + ';expires=' + expires.toUTCString() + ';path=/;SameSite=Lax';
}

function getCookie(name) {
    const value = "; " + document.cookie;
    const parts = value.split("; " + name + "=");
    if (parts.length === 2) return parts.pop().split(";").shift();
}

function acceptCookies() {
    setCookie('cookie-consent', 'accepted', 365);
    document.getElementById('cookie-banner').classList.remove('show');
    loadGoogleAnalytics();
}

function declineCookies() {
    setCookie('cookie-consent', 'declined', 365);
    document.getElementById('cookie-banner').classList.remove('show');
}

function loadGoogleAnalytics() {
    {{- if eq site.Params.env "production" }}
    {{- if site.Params.googleAnalytics }}
    // Load Google Analytics
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ site.Params.googleAnalytics }}', {
        'anonymize_ip': true,
        'cookie_flags': 'SameSite=Lax;Secure'
    });
    
    // Load the GA script
    const script = document.createElement('script');
    script.async = true;
    script.src = 'https://www.googletagmanager.com/gtag/js?id={{ site.Params.googleAnalytics }}';
    document.head.appendChild(script);
    {{- end }}
    {{- end }}
}

// Check consent on page load
document.addEventListener('DOMContentLoaded', function() {
    const consent = getCookie('cookie-consent');
    
    if (consent === 'accepted') {
        // User has already accepted, load analytics
        loadGoogleAnalytics();
    } else if (consent === 'declined') {
        // User has declined, don't show banner or load analytics
        return;
    } else {
        // No consent decision yet, show banner
        document.getElementById('cookie-banner').classList.add('show');
    }
});
</script>